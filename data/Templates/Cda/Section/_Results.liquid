{% assign firstSections = msg | get_first_cda_sections_by_template_id: '2.16.840.1.113883.10.20.22.2.3.1' -%}
{% assign entries = firstSections.2_16_840_1_113883_10_20_22_2_3_1.entry | to_array -%}
{% for e in entries -%}
    {% assign diagnosticId = e.organizer | to_json_string | generate_uuid -%}
    {% include 'Resource/DiagnosticReport' diagReport: e.organizer, ID: diagnosticId -%}
    {% include 'Reference/DiagnosticReport/Subject' ID: diagnosticId, REF: fullPatientId -%}

    {% assign components = e.organizer.component | to_array -%}
    {% for c in components -%}
        {% if c.observation -%}
            {% assign observationId = c.observation | to_json_string | generate_uuid -%}
            {% include 'Resource/Observation' observationCategory: 'laboratory', observationEntry: c.observation, ID: observationId-%}
            {% assign fullObservationId = observationId | prepend: 'Observation/' -%}
            {% include 'Reference/DiagnosticReport/Result' ID: diagnosticId, REF: fullObservationId -%}
            {% include 'Reference/Observation/Subject' ID: observationId, REF: fullPatientId -%}
        {% endif -%}
    {% endfor -%}
{% endfor -%}