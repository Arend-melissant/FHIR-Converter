{
    "fullUrl":"urn:uuid:{{ID}}",
    "resource":{
        "resourceType": "AllergyIntolerance",
        "id":"{{ID}}",
        "clinicalStatus":"{{allergyEntry.act.statusCode.code}}",
        "category":[
            {{#each (toArray allergyEntry.act.entryRelationship)}}
                {{#if (contains (toJsonString this.observation.templateId) '2.16.840.1.113883.10.20.22.4.7')}}
           	        {{#if (eq this.observation.value.xsi:type 'CD')}}
                        "{{>ValueSet/AllergyCategory.hbs code=this.observation.value.code}}",
                    {{/if}}
                {{/if}}
        	{{/each}}
        ]
        "reaction":
        [
            {{#each (toArray allergyEntry.act.entryRelationship)}}
        		{{#if (contains (toJsonString this.observation.templateId) '2.16.840.1.113883.10.20.22.4.7')}}
           			{
           				"substance": {{>DataType/CodeableConcept.hbs code=this.observation.participant.participantRole.playingEntity.code}},
                        "substance": {{>DataType/CodeableConcept.hbs code=this.observation.participant.participantRole.playingEntity.code.translation}},  
                        {{#each (toArray this.observation.entryRelationship)}}
                        	{{#if (contains (toJsonString this.observation.templateId) '2.16.840.1.113883.10.20.22.4.9')}}
                				"manifestation":
                				[
                                	{{#if (eq this.observation.value.xsi:type 'CD')}}
                                    	{{#if this.observation.value.translation}}
                              			    {{>DataType/CodeableConcept.hbs code=this.observation.value.translation}},
                                        {{else}}
                                        	{{>DataType/CodeableConcept.hbs code=this.observation.value}},
                                        {{/if}}
                            		{{/if}}
                				],
								"severity":
								[
                            		{{>DataType/CodeableConcept.hbs code=this.observation.entryRelationship.observation.value.translation}},	
                            	],
                        		"onset": "{{formatAsDateTime this.observation.effectiveTime.low.value}}"
                            {{/if}}
                        {{/each}}
            		},
                {{/if}}
            {{/each}}
        ],      
        "onsetDateTime":"{{formatAsDateTime allergyEntry.act.effectiveTime.low.value}}",
    },
    "request":{
        "method":"POST",
        "url":"AllergyIntolerance",
    },
},